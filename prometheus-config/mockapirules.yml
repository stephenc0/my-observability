# Code generated by Sloth (dev): https://github.com/slok/sloth.
# DO NOT EDIT.

groups:
  - name: sloth-slo-sli-recordings-mockapi-requests-availability
    rules:
    - record: slo:sli_error:ratio_rate5m
      expr: |
        (sum(increase(http_request_duration_seconds_count{endpoint!="/metrics", instance="mockapi:8082", status=~"([5|4].{2})"}[5m])))
        /
        (sum(increase(http_request_duration_seconds_count{endpoint!="/metrics", instance="mockapi:8082"}[5m])))
      labels:
        owner: stephen
        repo: stephencarnold/mockapi
        sloth_id: mockapi-requests-availability
        sloth_service: mockapi
        sloth_slo: requests-availability
        sloth_window: 5m
        tier: "1"
    - record: slo:sli_error:ratio_rate30m
      expr: |
        (sum(increase(http_request_duration_seconds_count{endpoint!="/metrics", instance="mockapi:8082", status=~"([5|4].{2})"}[30m])))
        /
        (sum(increase(http_request_duration_seconds_count{endpoint!="/metrics", instance="mockapi:8082"}[30m])))
      labels:
        owner: stephen
        repo: stephencarnold/mockapi
        sloth_id: mockapi-requests-availability
        sloth_service: mockapi
        sloth_slo: requests-availability
        sloth_window: 30m
        tier: "1"
    - record: slo:sli_error:ratio_rate1h
      expr: |
        (sum(increase(http_request_duration_seconds_count{endpoint!="/metrics", instance="mockapi:8082", status=~"([5|4].{2})"}[1h])))
        /
        (sum(increase(http_request_duration_seconds_count{endpoint!="/metrics", instance="mockapi:8082"}[1h])))
      labels:
        owner: stephen
        repo: stephencarnold/mockapi
        sloth_id: mockapi-requests-availability
        sloth_service: mockapi
        sloth_slo: requests-availability
        sloth_window: 1h
        tier: "1"
    - record: slo:sli_error:ratio_rate2h
      expr: |
        (sum(increase(http_request_duration_seconds_count{endpoint!="/metrics", instance="mockapi:8082", status=~"([5|4].{2})"}[2h])))
        /
        (sum(increase(http_request_duration_seconds_count{endpoint!="/metrics", instance="mockapi:8082"}[2h])))
      labels:
        owner: stephen
        repo: stephencarnold/mockapi
        sloth_id: mockapi-requests-availability
        sloth_service: mockapi
        sloth_slo: requests-availability
        sloth_window: 2h
        tier: "1"
    - record: slo:sli_error:ratio_rate6h
      expr: |
        (sum(increase(http_request_duration_seconds_count{endpoint!="/metrics", instance="mockapi:8082", status=~"([5|4].{2})"}[6h])))
        /
        (sum(increase(http_request_duration_seconds_count{endpoint!="/metrics", instance="mockapi:8082"}[6h])))
      labels:
        owner: stephen
        repo: stephencarnold/mockapi
        sloth_id: mockapi-requests-availability
        sloth_service: mockapi
        sloth_slo: requests-availability
        sloth_window: 6h
        tier: "1"
    - record: slo:sli_error:ratio_rate1d
      expr: |
        (sum(increase(http_request_duration_seconds_count{endpoint!="/metrics", instance="mockapi:8082", status=~"([5|4].{2})"}[1d])))
        /
        (sum(increase(http_request_duration_seconds_count{endpoint!="/metrics", instance="mockapi:8082"}[1d])))
      labels:
        owner: stephen
        repo: stephencarnold/mockapi
        sloth_id: mockapi-requests-availability
        sloth_service: mockapi
        sloth_slo: requests-availability
        sloth_window: 1d
        tier: "1"
    - record: slo:sli_error:ratio_rate3d
      expr: |
        (sum(increase(http_request_duration_seconds_count{endpoint!="/metrics", instance="mockapi:8082", status=~"([5|4].{2})"}[3d])))
        /
        (sum(increase(http_request_duration_seconds_count{endpoint!="/metrics", instance="mockapi:8082"}[3d])))
      labels:
        owner: stephen
        repo: stephencarnold/mockapi
        sloth_id: mockapi-requests-availability
        sloth_service: mockapi
        sloth_slo: requests-availability
        sloth_window: 3d
        tier: "1"
    - record: slo:sli_error:ratio_rate30d
      expr: |
        sum_over_time(slo:sli_error:ratio_rate5m{sloth_id="mockapi-requests-availability", sloth_service="mockapi", sloth_slo="requests-availability"}[30d])
        / ignoring (sloth_window)
        count_over_time(slo:sli_error:ratio_rate5m{sloth_id="mockapi-requests-availability", sloth_service="mockapi", sloth_slo="requests-availability"}[30d])
      labels:
        owner: stephen
        repo: stephencarnold/mockapi
        sloth_id: mockapi-requests-availability
        sloth_service: mockapi
        sloth_slo: requests-availability
        sloth_window: 30d
        tier: "1"
  - name: sloth-slo-meta-recordings-mockapi-requests-availability
    rules:
    - record: slo:objective:ratio
      expr: vector(0.95)
      labels:
        owner: stephen
        repo: stephencarnold/mockapi
        sloth_id: mockapi-requests-availability
        sloth_service: mockapi
        sloth_slo: requests-availability
        tier: "1"
    - record: slo:error_budget:ratio
      expr: vector(1-0.95)
      labels:
        owner: stephen
        repo: stephencarnold/mockapi
        sloth_id: mockapi-requests-availability
        sloth_service: mockapi
        sloth_slo: requests-availability
        tier: "1"
    - record: slo:time_period:days
      expr: vector(30)
      labels:
        owner: stephen
        repo: stephencarnold/mockapi
        sloth_id: mockapi-requests-availability
        sloth_service: mockapi
        sloth_slo: requests-availability
        tier: "1"
    - record: slo:current_burn_rate:ratio
      expr: |
        slo:sli_error:ratio_rate5m{sloth_id="mockapi-requests-availability", sloth_service="mockapi", sloth_slo="requests-availability"}
        / on(sloth_id, sloth_slo, sloth_service) group_left
        slo:error_budget:ratio{sloth_id="mockapi-requests-availability", sloth_service="mockapi", sloth_slo="requests-availability"}
      labels:
        owner: stephen
        repo: stephencarnold/mockapi
        sloth_id: mockapi-requests-availability
        sloth_service: mockapi
        sloth_slo: requests-availability
        tier: "1"
    - record: slo:period_burn_rate:ratio
      expr: |
        slo:sli_error:ratio_rate30d{sloth_id="mockapi-requests-availability", sloth_service="mockapi", sloth_slo="requests-availability"}
        / on(sloth_id, sloth_slo, sloth_service) group_left
        slo:error_budget:ratio{sloth_id="mockapi-requests-availability", sloth_service="mockapi", sloth_slo="requests-availability"}
      labels:
        owner: stephen
        repo: stephencarnold/mockapi
        sloth_id: mockapi-requests-availability
        sloth_service: mockapi
        sloth_slo: requests-availability
        tier: "1"
    - record: slo:period_error_budget_remaining:ratio
      expr: 1 - slo:period_burn_rate:ratio{sloth_id="mockapi-requests-availability",
        sloth_service="mockapi", sloth_slo="requests-availability"}
      labels:
        owner: stephen
        repo: stephencarnold/mockapi
        sloth_id: mockapi-requests-availability
        sloth_service: mockapi
        sloth_slo: requests-availability
        tier: "1"
    - record: sloth_slo_info
      expr: vector(1)
      labels:
        owner: stephen
        repo: stephencarnold/mockapi
        sloth_id: mockapi-requests-availability
        sloth_mode: cli-gen-prom
        sloth_objective: "95"
        sloth_service: mockapi
        sloth_slo: requests-availability
        sloth_spec: prometheus/v1
        sloth_version: dev
        tier: "1"
  - name: sloth-slo-alerts-mockapi-requests-availability
    rules:
    - alert: mockapiHighErrorRate
      expr: |
        (
            max(slo:sli_error:ratio_rate5m{sloth_id="mockapi-requests-availability", sloth_service="mockapi", sloth_slo="requests-availability"} > (14.4 * 0.05)) without (sloth_window)
            and
            max(slo:sli_error:ratio_rate1h{sloth_id="mockapi-requests-availability", sloth_service="mockapi", sloth_slo="requests-availability"} > (14.4 * 0.05)) without (sloth_window)
        )
        or
        (
            max(slo:sli_error:ratio_rate30m{sloth_id="mockapi-requests-availability", sloth_service="mockapi", sloth_slo="requests-availability"} > (6 * 0.05)) without (sloth_window)
            and
            max(slo:sli_error:ratio_rate6h{sloth_id="mockapi-requests-availability", sloth_service="mockapi", sloth_slo="requests-availability"} > (6 * 0.05)) without (sloth_window)
        )
      labels:
        category: availability
        routing_key: myteam
        severity: pageteam
        sloth_severity: page
      annotations:
        summary: High error rate on 'mockapi' requests responses
        title: (page) {{$labels.sloth_service}} {{$labels.sloth_slo}} SLO error budget
          burn rate is too fast.
    - alert: mockapiHighErrorRate
      expr: |
        (
            max(slo:sli_error:ratio_rate2h{sloth_id="mockapi-requests-availability", sloth_service="mockapi", sloth_slo="requests-availability"} > (3 * 0.05)) without (sloth_window)
            and
            max(slo:sli_error:ratio_rate1d{sloth_id="mockapi-requests-availability", sloth_service="mockapi", sloth_slo="requests-availability"} > (3 * 0.05)) without (sloth_window)
        )
        or
        (
            max(slo:sli_error:ratio_rate6h{sloth_id="mockapi-requests-availability", sloth_service="mockapi", sloth_slo="requests-availability"} > (1 * 0.05)) without (sloth_window)
            and
            max(slo:sli_error:ratio_rate3d{sloth_id="mockapi-requests-availability", sloth_service="mockapi", sloth_slo="requests-availability"} > (1 * 0.05)) without (sloth_window)
        )
      labels:
        category: availability
        severity: slack
        slack_channel: '#alerts-myteam'
        sloth_severity: ticket
      annotations:
        summary: High error rate on 'mockapi' requests responses
        title: (ticket) {{$labels.sloth_service}} {{$labels.sloth_slo}} SLO error budget
          burn rate is too fast.
  - name: sloth-slo-sli-recordings-mockapi-requests-latency
    rules:
    - record: slo:sli_error:ratio_rate5m
      expr: |
        (sum(increase(http_request_duration_seconds_bucket{endpoint!="/metrics", instance="mockapi:8082", le="+Inf"}[5m])) - sum(increase(http_request_duration_seconds_bucket{endpoint!="/metrics", instance="mockapi:8082", le="0.05"}[5m])))
        /
        (sum(increase(http_request_duration_seconds_bucket{endpoint!="/metrics", instance="mockapi:8082", le="+Inf"}[5m])))
      labels:
        owner: stephen
        repo: stephencarnold/mockapi
        sloth_id: mockapi-requests-latency
        sloth_service: mockapi
        sloth_slo: requests-latency
        sloth_window: 5m
        tier: "1"
    - record: slo:sli_error:ratio_rate30m
      expr: |
        (sum(increase(http_request_duration_seconds_bucket{endpoint!="/metrics", instance="mockapi:8082", le="+Inf"}[30m])) - sum(increase(http_request_duration_seconds_bucket{endpoint!="/metrics", instance="mockapi:8082", le="0.05"}[30m])))
        /
        (sum(increase(http_request_duration_seconds_bucket{endpoint!="/metrics", instance="mockapi:8082", le="+Inf"}[30m])))
      labels:
        owner: stephen
        repo: stephencarnold/mockapi
        sloth_id: mockapi-requests-latency
        sloth_service: mockapi
        sloth_slo: requests-latency
        sloth_window: 30m
        tier: "1"
    - record: slo:sli_error:ratio_rate1h
      expr: |
        (sum(increase(http_request_duration_seconds_bucket{endpoint!="/metrics", instance="mockapi:8082", le="+Inf"}[1h])) - sum(increase(http_request_duration_seconds_bucket{endpoint!="/metrics", instance="mockapi:8082", le="0.05"}[1h])))
        /
        (sum(increase(http_request_duration_seconds_bucket{endpoint!="/metrics", instance="mockapi:8082", le="+Inf"}[1h])))
      labels:
        owner: stephen
        repo: stephencarnold/mockapi
        sloth_id: mockapi-requests-latency
        sloth_service: mockapi
        sloth_slo: requests-latency
        sloth_window: 1h
        tier: "1"
    - record: slo:sli_error:ratio_rate2h
      expr: |
        (sum(increase(http_request_duration_seconds_bucket{endpoint!="/metrics", instance="mockapi:8082", le="+Inf"}[2h])) - sum(increase(http_request_duration_seconds_bucket{endpoint!="/metrics", instance="mockapi:8082", le="0.05"}[2h])))
        /
        (sum(increase(http_request_duration_seconds_bucket{endpoint!="/metrics", instance="mockapi:8082", le="+Inf"}[2h])))
      labels:
        owner: stephen
        repo: stephencarnold/mockapi
        sloth_id: mockapi-requests-latency
        sloth_service: mockapi
        sloth_slo: requests-latency
        sloth_window: 2h
        tier: "1"
    - record: slo:sli_error:ratio_rate6h
      expr: |
        (sum(increase(http_request_duration_seconds_bucket{endpoint!="/metrics", instance="mockapi:8082", le="+Inf"}[6h])) - sum(increase(http_request_duration_seconds_bucket{endpoint!="/metrics", instance="mockapi:8082", le="0.05"}[6h])))
        /
        (sum(increase(http_request_duration_seconds_bucket{endpoint!="/metrics", instance="mockapi:8082", le="+Inf"}[6h])))
      labels:
        owner: stephen
        repo: stephencarnold/mockapi
        sloth_id: mockapi-requests-latency
        sloth_service: mockapi
        sloth_slo: requests-latency
        sloth_window: 6h
        tier: "1"
    - record: slo:sli_error:ratio_rate1d
      expr: |
        (sum(increase(http_request_duration_seconds_bucket{endpoint!="/metrics", instance="mockapi:8082", le="+Inf"}[1d])) - sum(increase(http_request_duration_seconds_bucket{endpoint!="/metrics", instance="mockapi:8082", le="0.05"}[1d])))
        /
        (sum(increase(http_request_duration_seconds_bucket{endpoint!="/metrics", instance="mockapi:8082", le="+Inf"}[1d])))
      labels:
        owner: stephen
        repo: stephencarnold/mockapi
        sloth_id: mockapi-requests-latency
        sloth_service: mockapi
        sloth_slo: requests-latency
        sloth_window: 1d
        tier: "1"
    - record: slo:sli_error:ratio_rate3d
      expr: |
        (sum(increase(http_request_duration_seconds_bucket{endpoint!="/metrics", instance="mockapi:8082", le="+Inf"}[3d])) - sum(increase(http_request_duration_seconds_bucket{endpoint!="/metrics", instance="mockapi:8082", le="0.05"}[3d])))
        /
        (sum(increase(http_request_duration_seconds_bucket{endpoint!="/metrics", instance="mockapi:8082", le="+Inf"}[3d])))
      labels:
        owner: stephen
        repo: stephencarnold/mockapi
        sloth_id: mockapi-requests-latency
        sloth_service: mockapi
        sloth_slo: requests-latency
        sloth_window: 3d
        tier: "1"
    - record: slo:sli_error:ratio_rate30d
      expr: |
        sum_over_time(slo:sli_error:ratio_rate5m{sloth_id="mockapi-requests-latency", sloth_service="mockapi", sloth_slo="requests-latency"}[30d])
        / ignoring (sloth_window)
        count_over_time(slo:sli_error:ratio_rate5m{sloth_id="mockapi-requests-latency", sloth_service="mockapi", sloth_slo="requests-latency"}[30d])
      labels:
        owner: stephen
        repo: stephencarnold/mockapi
        sloth_id: mockapi-requests-latency
        sloth_service: mockapi
        sloth_slo: requests-latency
        sloth_window: 30d
        tier: "1"
  - name: sloth-slo-meta-recordings-mockapi-requests-latency
    rules:
    - record: slo:objective:ratio
      expr: vector(0.95)
      labels:
        owner: stephen
        repo: stephencarnold/mockapi
        sloth_id: mockapi-requests-latency
        sloth_service: mockapi
        sloth_slo: requests-latency
        tier: "1"
    - record: slo:error_budget:ratio
      expr: vector(1-0.95)
      labels:
        owner: stephen
        repo: stephencarnold/mockapi
        sloth_id: mockapi-requests-latency
        sloth_service: mockapi
        sloth_slo: requests-latency
        tier: "1"
    - record: slo:time_period:days
      expr: vector(30)
      labels:
        owner: stephen
        repo: stephencarnold/mockapi
        sloth_id: mockapi-requests-latency
        sloth_service: mockapi
        sloth_slo: requests-latency
        tier: "1"
    - record: slo:current_burn_rate:ratio
      expr: |
        slo:sli_error:ratio_rate5m{sloth_id="mockapi-requests-latency", sloth_service="mockapi", sloth_slo="requests-latency"}
        / on(sloth_id, sloth_slo, sloth_service) group_left
        slo:error_budget:ratio{sloth_id="mockapi-requests-latency", sloth_service="mockapi", sloth_slo="requests-latency"}
      labels:
        owner: stephen
        repo: stephencarnold/mockapi
        sloth_id: mockapi-requests-latency
        sloth_service: mockapi
        sloth_slo: requests-latency
        tier: "1"
    - record: slo:period_burn_rate:ratio
      expr: |
        slo:sli_error:ratio_rate30d{sloth_id="mockapi-requests-latency", sloth_service="mockapi", sloth_slo="requests-latency"}
        / on(sloth_id, sloth_slo, sloth_service) group_left
        slo:error_budget:ratio{sloth_id="mockapi-requests-latency", sloth_service="mockapi", sloth_slo="requests-latency"}
      labels:
        owner: stephen
        repo: stephencarnold/mockapi
        sloth_id: mockapi-requests-latency
        sloth_service: mockapi
        sloth_slo: requests-latency
        tier: "1"
    - record: slo:period_error_budget_remaining:ratio
      expr: 1 - slo:period_burn_rate:ratio{sloth_id="mockapi-requests-latency", sloth_service="mockapi",
        sloth_slo="requests-latency"}
      labels:
        owner: stephen
        repo: stephencarnold/mockapi
        sloth_id: mockapi-requests-latency
        sloth_service: mockapi
        sloth_slo: requests-latency
        tier: "1"
    - record: sloth_slo_info
      expr: vector(1)
      labels:
        owner: stephen
        repo: stephencarnold/mockapi
        sloth_id: mockapi-requests-latency
        sloth_mode: cli-gen-prom
        sloth_objective: "95"
        sloth_service: mockapi
        sloth_slo: requests-latency
        sloth_spec: prometheus/v1
        sloth_version: dev
        tier: "1"
  - name: sloth-slo-alerts-mockapi-requests-latency
    rules:
    - alert: mockapiHighLatency
      expr: |
        (
            max(slo:sli_error:ratio_rate5m{sloth_id="mockapi-requests-latency", sloth_service="mockapi", sloth_slo="requests-latency"} > (14.4 * 0.05)) without (sloth_window)
            and
            max(slo:sli_error:ratio_rate1h{sloth_id="mockapi-requests-latency", sloth_service="mockapi", sloth_slo="requests-latency"} > (14.4 * 0.05)) without (sloth_window)
        )
        or
        (
            max(slo:sli_error:ratio_rate30m{sloth_id="mockapi-requests-latency", sloth_service="mockapi", sloth_slo="requests-latency"} > (6 * 0.05)) without (sloth_window)
            and
            max(slo:sli_error:ratio_rate6h{sloth_id="mockapi-requests-latency", sloth_service="mockapi", sloth_slo="requests-latency"} > (6 * 0.05)) without (sloth_window)
        )
      labels:
        category: latency
        routing_key: myteam
        severity: pageteam
        sloth_severity: page
      annotations:
        summary: High latency on 'mockapi' requests responses
        title: (page) {{$labels.sloth_service}} {{$labels.sloth_slo}} SLO error budget
          burn rate is too fast.
    - alert: mockapiHighLatency
      expr: |
        (
            max(slo:sli_error:ratio_rate2h{sloth_id="mockapi-requests-latency", sloth_service="mockapi", sloth_slo="requests-latency"} > (3 * 0.05)) without (sloth_window)
            and
            max(slo:sli_error:ratio_rate1d{sloth_id="mockapi-requests-latency", sloth_service="mockapi", sloth_slo="requests-latency"} > (3 * 0.05)) without (sloth_window)
        )
        or
        (
            max(slo:sli_error:ratio_rate6h{sloth_id="mockapi-requests-latency", sloth_service="mockapi", sloth_slo="requests-latency"} > (1 * 0.05)) without (sloth_window)
            and
            max(slo:sli_error:ratio_rate3d{sloth_id="mockapi-requests-latency", sloth_service="mockapi", sloth_slo="requests-latency"} > (1 * 0.05)) without (sloth_window)
        )
      labels:
        category: latency
        severity: slack
        slack_channel: '#alerts-myteam'
        sloth_severity: ticket
      annotations:
        summary: High latency on 'mockapi' requests responses
        title: (ticket) {{$labels.sloth_service}} {{$labels.sloth_slo}} SLO error budget
          burn rate is too fast.
